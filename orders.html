<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Orders | Timecraze</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--primary:#121212;--secondary:#1a1a1a;--accent:#d4af37;--accent-dark:#b8941f;--text:#e0e0e0;--text-light:#a0a0a0;--card-bg:#1e1e1e;--white:#fff;--border:#333}
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Montserrat','Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{background:var(--primary);color:var(--text)}
    nav{position:fixed;top:0;width:100%;background:rgba(18,18,18,.95);backdrop-filter:blur(20px);padding:1.2rem 5%;display:flex;justify-content:space-between;align-items:center;z-index:1000;border-bottom:1px solid var(--border)}
    .logo{font-size:1.8rem;font-weight:700;color:var(--white);display:flex;gap:.5rem;align-items:center}
    .logo span{color:var(--accent)}
    .nav-links{display:flex;gap:2rem}
    .nav-links a{color:var(--text);text-decoration:none;position:relative}
    .nav-links a::after{content:"";position:absolute;left:0;bottom:-8px;height:2px;width:0;background:var(--accent);transition:width .3s}
    .nav-links a:hover::after,.nav-links a.active::after{width:100%}
    .nav-actions{display:flex;align-items:center;gap:1.2rem}
    .avatar-btn{display:flex;align-items:center;gap:.5rem;cursor:pointer;color:var(--text);text-decoration:none;font-size:.95rem;position:relative}
    .avatar-circle{width:32px;height:32px;border-radius:50%;overflow:hidden;display:inline-flex;align-items:center;justify-content:center;background:#333;font-size:.8rem}
    .avatar-circle img{width:100%;height:100%;object-fit:cover}
    .dropdown{position:absolute;right:0;top:110%;background:#181818;border:1px solid var(--border);border-radius:10px;min-width:200px;padding:.4rem 0;display:none;z-index:1200}
    .dropdown a{display:block;padding:.55rem 1rem;color:var(--text);text-decoration:none;font-size:.9rem}
    .dropdown a:hover{background:#222}
    .container{padding:120px 8% 60px}
    h1{color:#fff;font-weight:500;margin-bottom:1rem}
    .list{display:grid;gap:1rem}
    .order{background:var(--card-bg);border:1px solid var(--border);border-radius:14px;padding:1rem;display:grid;grid-template-columns:1fr auto;gap:1rem;align-items:center}
    .muted{color:var(--text-light)}
    .btn{display:inline-block;border:none;border-radius:999px;padding:.6rem 1rem;font-weight:600;cursor:pointer;transition:all .25s;text-decoration:none}
    .btn-primary{background:var(--accent);color:var(--primary)}
    .btn-secondary{background:transparent;color:#fff;border:1px solid #fff}
    .items{display:flex;gap:.5rem;flex-wrap:wrap}
    .pill{border:1px solid var(--border);border-radius:999px;padding:.2rem .6rem;font-size:.8rem}
    .empty{background:var(--card-bg);border:1px solid var(--border);border-radius:14px;padding:1.5rem;text-align:center}
  </style>
</head>
<body>
  <nav>
    <a href="{{ url_for('home') }}" class="logo"><i class="fas fa-crown"></i>Time<span>craze</span></a>
    <div style="display:flex;align-items:center;gap:2.5rem;">
      <div class="nav-links">
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('products.shop') }}">Collections</a>
        <a href="{{ url_for('new_arrivals') }}">New Arrivals</a>
        <a href="{{ url_for('limited_edition') }}">Limited Edition</a>
        <a href="{{ url_for('about') }}">About</a>
      </div>
      <div class="nav-actions">
        <a href="{{ url_for('cart.view_cart') }}" title="Cart"><i class="fas fa-shopping-bag"></i></a>
        <div style="position:relative;">
          <div class="avatar-btn" id="ordersAccountToggle">
            <div class="avatar-circle">
              {% if session.get('avatar_url') %}
                <img src="{{ session.get('avatar_url') }}" alt="Me">
              {% else %}
                <i class="fas fa-user"></i>
              {% endif %}
            </div>
            <span>Account</span>
          </div>
          <div class="dropdown" id="ordersAccountMenu">
            <a href="{{ url_for('orders.view_orders') }}">My Orders</a>
            <a href="{{ url_for('track') }}">Track Order</a>
            <a href="{{ url_for('about') }}">About</a>
            <a href="{{ url_for('legacy_contact') }}">Contact</a>
            <a href="{{ url_for('profile.profile') }}">Profile</a>
            <a href="{{ url_for('auth.logout') }}">Logout</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <div class="container">
    <h1>My Orders</h1>
    <div class="list">
      {% if orders %}
        {% for o in orders %}
        <div class="order">
          <div>
            <div>
              <strong>Order #{{ o['_id']|string|truncate(8, True, '') }}</strong>
              <span class="muted">• {{ o['created_at'].strftime('%d %b %Y, %I:%M %p') if o.get('created_at') else '' }}</span>
            </div>
            <div class="muted">
              {{ o['items']|length }} item{{ 's' if o['items']|length != 1 else '' }}
            </div>
            {% if o['items'] %}
            <div class="items" style="margin:0.25rem 0 0.5rem;">
              {% for it in o['items'] %}
              <div class="pill" style="display:flex;align-items:center;gap:0.5rem;">
                {% if it.image %}
                  <img src="{{ it.image }}" alt="{{ it.name }}" style="width:28px;height:28px;border-radius:6px;object-fit:cover;">
                {% endif %}
                <span>{{ it.name or 'Item' }}</span>
              </div>
              {% endfor %}
            </div>
            {% endif %}
            <div class="muted">Total: ₹{{ '%.2f'|format(o['total'] or 0) }}</div>
          </div>
          <div style="display:flex;gap:.5rem;align-items:center;">
            <a class="btn btn-secondary" href="{{ url_for('orders.track_order', order_id=o['_id']) }}">
              Track
            </a>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="empty">No orders yet.
          <a class="btn btn-primary" href="{{ url_for('home') }}" style="margin-left:.5rem;">Shop Now</a>
        </div>
      {% endif %}
    </div>
  </div>
</body>
</html>
