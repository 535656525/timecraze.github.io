<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Timecraze{% endblock %}</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  {% block head %}{% endblock %}
  <style>
    :root{--primary:#121212;--secondary:#1a1a1a;--accent:#d4af37;--text:#e0e0e0;--border:#333}
    body{margin:0;background:var(--primary);color:var(--text);line-height:1.6;overflow-x:hidden}
    nav{position:sticky;top:0;width:100%;background:rgba(18,18,18,.95);backdrop-filter:blur(12px);padding:1.2rem 5%;display:flex;justify-content:space-between;align-items:center;z-index:1000;border-bottom:1px solid var(--border);transition:all .4s cubic-bezier(.25,.46,.45,.94)}
    .logo{font-size:1.8rem;font-weight:700;color:#fff;display:flex;gap:.5rem;align-items:center}
    .logo span{color:var(--accent)}
    .nav-links{display:flex;gap:2rem;align-items:center}
    .nav-links a{color:var(--text);text-decoration:none;font-weight:500;font-size:.95rem;position:relative;transition:all .3s ease}
    .nav-links a::after{content:"";position:absolute;left:0;bottom:-8px;height:2px;width:0;background:var(--accent);transition:width .3s ease}
    .nav-links a:hover::after{width:100%}
    .nav-actions{display:flex;align-items:center;gap:1.2rem}
    .avatar-btn{display:flex;align-items:center;gap:.5rem;cursor:pointer;color:var(--text);text-decoration:none;font-size:.95rem;position:relative}
    .avatar-circle{width:32px;height:32px;border-radius:50%;overflow:hidden;display:inline-flex;align-items:center;justify-content:center;background:#333;font-size:.8rem}
    .avatar-circle img{width:100%;height:100%;object-fit:cover}
    .dropdown{position:absolute;right:0;top:110%;background:#181818;border:1px solid var(--border);border-radius:10px;min-width:200px;padding:.4rem 0;display:none;z-index:1200}
    .dropdown a{display:block;padding:.55rem 1rem;color:var(--text);text-decoration:none;font-size:.9rem}
    .dropdown a:hover{background:#222}
    footer{background:var(--secondary);border-top:1px solid var(--border);padding:2rem 5%;margin-top:3rem;color:#a0a0a0}
  </style>
</head>
<body>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  <nav>
    <a href="{{ url_for('home') }}" class="logo">Time<span>craze</span></a>
    <div style="display:flex;align-items:center;gap:2.5rem;">
      <div class="nav-links">
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('products.shop') }}">Collections</a>
        <a href="{{ url_for('new_arrivals') }}">New Arrivals</a>
        <a href="{{ url_for('limited_edition') }}">Limited Edition</a>
        <a href="{{ url_for('about') }}">About Us</a>
        <a href="{{ url_for('legacy_contact') }}">Contact Us</a>
      </div>
      <div class="nav-actions">
        <a href="{{ url_for('cart.view_cart') }}" title="Cart"><i class="fas fa-shopping-bag"></i></a>
        {% if session.get('user_id') %}
          <div style="position:relative;">
            <div class="avatar-btn" id="accountToggle">
              <div class="avatar-circle">
                {% if session.get('avatar_url') %}
                  <img src="{{ session.get('avatar_url') }}" alt="Me">
                {% else %}
                  <i class="fas fa-user"></i>
                {% endif %}
              </div>
              <span>Account</span>
            </div>
            <div class="dropdown" id="accountMenu">
              <a href="{{ url_for('orders.view_orders') }}">My Orders</a>
              <a href="{{ url_for('track') }}">Track Order</a>
              <a href="{{ url_for('about') }}">About</a>
              <a href="{{ url_for('legacy_contact') }}">Contact</a>
              <a href="{{ url_for('profile.profile') }}">Profile</a>
              <a href="{{ url_for('auth.logout') }}">Logout</a>
              <a id="adminLink" href="{{ url_for('admin.dashboard') }}" style="display:none">Admin</a>
            </div>
          </div>
        {% else %}
          <a href="{{ url_for('auth.login') }}" class="avatar-btn"><div class="avatar-circle"><i class="fas fa-user"></i></div><span>Login</span></a>
        {% endif %}
      </div>
    </div>
  </nav>

  {% block content %}{% endblock %}

  <footer>
    <div>&copy; {{ 2025 }} Timecraze. All rights reserved. · <a href="{{ url_for('about') }}" style="color:inherit;text-decoration:none;">About</a> · <a href="{{ url_for('legacy_contact') }}" style="color:inherit;text-decoration:none;">Contact</a></div>
  </footer>

  <script>
    // Admin badge in account menu
    fetch("{{ url_for('auth.api_me') }}",{credentials:'same-origin'})
      .then(r=>r.ok?r.json():null)
      .then(d=>{ if(d&&d.user&&d.user.isAdmin){ var el=document.getElementById('adminLink'); if(el) el.style.display='block'; } })
      .catch(()=>{});

    // Simple account dropdown toggle
    (function(){
      var toggle = document.getElementById('accountToggle');
      var menu = document.getElementById('accountMenu');
      if(!toggle || !menu) return;
      toggle.addEventListener('click', function(e){
        e.stopPropagation();
        var isOpen = menu.style.display === 'block';
        menu.style.display = isOpen ? 'none' : 'block';
      });
      document.addEventListener('click', function(){
        menu.style.display = 'none';
      });
    })();
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
